<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" /><meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>PRE-REQs: &mdash; Devnet SPAUTO 0.1.0 documentation</title>
      <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
      <link rel="stylesheet" href="../../_static/css/theme.css" type="text/css" />
      <link rel="stylesheet" href="../../_static/graphviz.css" type="text/css" />
  <!--[if lt IE 9]>
    <script src="../../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script data-url_root="../../" id="documentation_options" src="../../_static/documentation_options.js"></script>
        <script src="../../_static/jquery.js"></script>
        <script src="../../_static/underscore.js"></script>
        <script src="../../_static/doctools.js"></script>
    <script src="../../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
            <a href="../../index.html" class="icon icon-home"> Devnet SPAUTO
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <ul>
<li class="toctree-l1"><a class="reference internal" href="../../index.html">Home</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../README.html">Readme</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../changelog.html">Changelog</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../autoapi/index.html">API Reference</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../index.html">Devnet SPAUTO</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../../index.html" class="icon icon-home"></a> &raquo;</li>
      <li>PRE-REQs:</li>
      <li class="wy-breadcrumbs-aside">
            <a href="../../_sources/SPAUTO/Network Programmability Foundation/4.6 Implement XR traffic controller (including topology information transfer to XTC).md.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <p>Hello! Thank you for taking the time to view my blog and (possibly) follow along! I have been spending time preparing for the DEVNET SPAUTO specialist certification and I hope to create some great content thats publically available for those trying to achieve this cert.
I’ve been gathering all the lab materials and automation I’ve created at the following personal repository:</p>
<p><a class="reference external" href="https://github.com/h4ndzdatm0ld/spauto_devnet.git">SPAUTO DEVNET REPO</a></p>
<p>This material will also be included inside the WIKI pages for the repo.</p>
<p>For my DEVNET SPAUTO studies I’ve decided to dedicate quite some time to XTC as I have never used or seen this application in a production Service Provider environment. This topic is part of the Automation and Orchestration (30%) from the SPAUTO blueprint.</p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>4.6 Implement XR traffic controller
(including topology information transfer to XTC) 
</pre></div>
</div>
<p>Let’s gets some general terms out of the way before we continue with our Lab demo.</p>
<p><strong>PCEP</strong></p>
<p>PCEP is a hierarchical protocol, running over TCP port 4189. PCEP has two main functions:</p>
<ol class="simple">
<li><p>Path Computation Element <strong>(PCE)</strong> - A software controller acting as the server within the PCEP protocol. The PCE has a global view of the entire topology of a network and is able to centralize Path Computation and apply Traffic-Engineering policies. PCE can be clustered for redundancy.</p></li>
<li><p>Path Computation Client <strong>(PCC)</strong> - The clients are network devices that can act as IP/MPLS Head-END Label Edge Routers (LER). The PCC devices receive operation instructions when signaling LSPs across a network (or multi-domain network) from the PCE. Optionally, local parameters can be used within the construct of the LSP when signaling alongside the information received from the PCE.</p></li>
</ol>
<p>There are several implementations of PCE solutions, like Juniper’s SDN North Star and Cisco Open SDN controllers (OpenDayLight). However, in our lab topology we will be using a Cisco IOSXRv as the XTC (PCE) server. All other devices that inquiry information from the XTC device (PCE) will be the acting PCC clients. We have two devices that are acting as Route-Reflectors in our lab, we will also enlist them as a synchronized pair of XR Traffic Controllers.</p>
<p><strong>BGP Link-State</strong></p>
<p>BGP-LS is a newer extended address-family for BGP.  (AFI=16388, SAFI=71) - This family distributes network link-state information to the northbound controller (XTC/PCE or JunOS Northstar, OpendayLight, etc) This AFI provides BGP with Traffic-Engineering capabilities by mapping the network out, regardless of reachability or separated ASN/Domains. This is because the networks IGP (OSPF or ISIS) link-state database is exported (distributed) through BGP.</p>
<p>Okay, lets head over to the demo! Our goal in our demonstration will outline an LSP being deployed across our IP/MPLS Network with Segment-Routing as the underlying Transport. Also, an LSP will be deployed across a multi-domain (ISIS-CORE &amp; ISIS-100) network. This specific multi-domain LSP is an incredible feature! Our PE1 LSP will have a far-end destination of PE100 which resides in a different domain and PE &lt;&gt; PE100 do not have network reachability to each other.</p>
<p><strong>XTC</strong>
XR Traffic Controller will be an IOSXRv device in our network. This device will have full PCE Server capabilities.</p>
<section id="pre-reqs">
<h1>PRE-REQs:<a class="headerlink" href="#pre-reqs" title="Permalink to this headline"></a></h1>
<p>There will be some basic information pertaining to Segment - Routing, but we will not go into great detail on how to configure SR in our network.</p>
<ol class="simple">
<li><p>Ensure your BGP sessions to the predetermined IOSXR device that will become the XTC Controller have BGP-LS enabled.</p></li>
<li><p>Ensure link-state information is being distributed from your IGP. In our case, we are using IS-IS. From the topology map, we are redistributing link-state information from our Provider Edge devices PE4 and PE2 as they are the edge devices between this Multi-Domain (ISIS) topology. This information is all propagated back to the Route-Reflector which is going to be our XTC/PCE controller.</p></li>
<li><p>Example IS-IS link-state distribution:</p></li>
</ol>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">config</span> <span class="n">t</span>
<span class="n">router</span> <span class="n">isis</span> <span class="n">core</span>
<span class="n">distribute</span> <span class="n">link</span><span class="o">-</span><span class="n">state</span> <span class="n">level</span> <span class="mi">2</span>
</pre></div>
</div>
<ol class="simple">
<li><p>Enable the link-state address family inside the BGP instance. Since I am enabling this on a Route-Reflector with a CLIENTS group, I will also add the family to the neighbor group. It’s important to add the address-family to the main BGP configuration otherwise the commit will fail. This family will also be added to the remote clients peering with this group.</p></li>
</ol>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">config</span> <span class="n">t</span>
<span class="n">router</span> <span class="n">bgp</span> <span class="mi">65000</span>
<span class="n">address</span><span class="o">-</span><span class="n">family</span> <span class="n">link</span><span class="o">-</span><span class="n">state</span> <span class="n">link</span><span class="o">-</span><span class="n">state</span>
<span class="n">exit</span>
<span class="n">neighbor</span><span class="o">-</span><span class="n">group</span> <span class="n">CLIENTS</span>
<span class="n">address</span><span class="o">-</span><span class="n">family</span> <span class="n">link</span><span class="o">-</span><span class="n">state</span> <span class="n">link</span><span class="o">-</span><span class="n">state</span>
<span class="n">commit</span>
</pre></div>
</div>
<ol class="simple">
<li><p>Enable XTC On the virtualized IOSXR Route Reflectors with state-sync to neighboring RR. I chose to use a RR for the sake of resources and ease to start as all BGP-LS information is readily available within this device.</p></li>
</ol>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>pce
address ipv4 {{loopback0}}
logging no-path
!
state-sync ipv4 172.16.0.201
segment-routing
! 
end
</pre></div>
</div>
<p>Verify there is BGP LS information available at the RRs posing as the XTC PCE Server. This is a must before moving forward!</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">show</span> <span class="n">bgp</span> <span class="n">link</span><span class="o">-</span><span class="n">state</span> <span class="n">link</span><span class="o">-</span><span class="n">state</span>
</pre></div>
</div>
<p>Verify that link-state topology is available for the PCE. This command is being performed from the PCE/XR Traffic Controller (IOSXR RR)</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">show</span> <span class="n">pce</span> <span class="n">ipv4</span> <span class="n">topology</span>
</pre></div>
</div>
<p>All of the hosts within our topology should be available in the link-state data. Visualizing the topology is easy, by piping the command in the following way:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">RP</span><span class="o">/</span><span class="mi">0</span><span class="o">/</span><span class="mi">0</span><span class="o">/</span><span class="n">CPU0</span><span class="p">:</span><span class="n">AS65000_RR2</span><span class="c1">#show pce ipv4 topology | include Host</span>

<span class="n">Sat</span> <span class="n">May</span> <span class="mi">22</span> <span class="mi">21</span><span class="p">:</span><span class="mi">03</span><span class="p">:</span><span class="mf">24.507</span> <span class="n">UTC</span>

  <span class="n">Host</span> <span class="n">name</span><span class="p">:</span> <span class="n">AS65000_P1</span>

      <span class="n">Host</span> <span class="n">name</span><span class="p">:</span> <span class="n">AS65000_PE1</span>

      <span class="n">Host</span> <span class="n">name</span><span class="p">:</span> <span class="n">AS65000_PE3</span>

  <span class="n">Host</span> <span class="n">name</span><span class="p">:</span> <span class="n">AS65000_P2</span>

      <span class="n">Host</span> <span class="n">name</span><span class="p">:</span> <span class="mf">1720.1610.0022</span>

      <span class="n">Host</span> <span class="n">name</span><span class="p">:</span> <span class="n">AS65000_P1</span>

      <span class="n">Host</span> <span class="n">name</span><span class="p">:</span> <span class="n">AS65000_RR1</span>

  <span class="n">Host</span> <span class="n">name</span><span class="p">:</span> <span class="n">AS65000_PE1</span>

      <span class="n">Host</span> <span class="n">name</span><span class="p">:</span> <span class="mf">1720.1610.0022</span>

      <span class="n">Host</span> <span class="n">name</span><span class="p">:</span> <span class="n">AS65000_P1</span>

  <span class="n">Host</span> <span class="n">name</span><span class="p">:</span> <span class="n">AS65000_PE3</span>

      <span class="n">Host</span> <span class="n">name</span><span class="p">:</span> <span class="n">AS65000_P1</span>

      <span class="n">Host</span> <span class="n">name</span><span class="p">:</span> <span class="n">AS65000_PE4</span>

  <span class="n">Host</span> <span class="n">name</span><span class="p">:</span> <span class="mf">1720.1610.0022</span>

      <span class="n">Host</span> <span class="n">name</span><span class="p">:</span> <span class="n">AS65000_PE1</span>

      <span class="n">Host</span> <span class="n">name</span><span class="p">:</span> <span class="n">AS65000_P2</span>

      <span class="n">Host</span> <span class="n">name</span><span class="p">:</span> <span class="n">AS65000_PE100</span>

  <span class="n">Host</span> <span class="n">name</span><span class="p">:</span> <span class="n">AS65000_PE4</span>

      <span class="n">Host</span> <span class="n">name</span><span class="p">:</span> <span class="n">AS65000_P2</span>

      <span class="n">Host</span> <span class="n">name</span><span class="p">:</span> <span class="n">AS65000_PE3</span>

  <span class="n">Host</span> <span class="n">name</span><span class="p">:</span> <span class="n">AS65000_RR1</span>

  <span class="n">Host</span> <span class="n">name</span><span class="p">:</span> <span class="n">AS65000_RR2</span>

  <span class="n">Host</span> <span class="n">name</span><span class="p">:</span> <span class="n">AS65000_PE100</span>

      <span class="n">Host</span> <span class="n">name</span><span class="p">:</span> <span class="mf">1720.1610.0022</span>

      <span class="n">Host</span> <span class="n">name</span><span class="p">:</span> <span class="n">AS65000_PE101</span>

  <span class="n">Host</span> <span class="n">name</span><span class="p">:</span> <span class="n">AS65000_PE101</span>

      <span class="n">Host</span> <span class="n">name</span><span class="p">:</span> <span class="n">AS65000_PE100</span>
</pre></div>
</div>
</section>
<section id="lsp-configuration-inter-domain-lsp">
<h1>LSP Configuration (Inter-Domain LSP)<a class="headerlink" href="#lsp-configuration-inter-domain-lsp" title="Permalink to this headline"></a></h1>
<p>Lets create an example LSP from our node AS65000_PE1 to our FOREIGN ISIS DOMAIN 100, PE101.
We will provide the traffic-eng configuration within MPLS to use our PCE peer (RR2). We will source our connection from our Loopback0 address at PE1.</p>
<p>Before we begin, lets check the computed path is available at the PCE XTC. If the path is not available, there could be some BGP-LS data missing or further troubleshooting is necessary before continuing. If there is no path, the LSP will not form at the PE.</p>
<p>Our PE device does NOT have reachability into ISIS Domain 100. We can verify this by attempting to reach the Loopback0 at PE101:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">RP</span><span class="o">/</span><span class="mi">0</span><span class="o">/</span><span class="mi">0</span><span class="o">/</span><span class="n">CPU0</span><span class="p">:</span><span class="n">AS65000_PE1</span><span class="c1">#show ip int br</span>
<span class="n">Sun</span> <span class="n">May</span> <span class="mi">23</span> <span class="mi">16</span><span class="p">:</span><span class="mi">32</span><span class="p">:</span><span class="mf">25.952</span> <span class="n">UTC</span>

<span class="n">Interface</span>                      <span class="n">IP</span><span class="o">-</span><span class="n">Address</span>      <span class="n">Status</span>          <span class="n">Protocol</span> <span class="n">Vrf</span><span class="o">-</span><span class="n">Name</span>
<span class="n">Loopback0</span>                      <span class="mf">172.16.0.11</span>     <span class="n">Up</span>              <span class="n">Up</span>       <span class="n">default</span> 

<span class="o">&lt;------</span><span class="n">omitted</span><span class="o">------&gt;</span>

<span class="n">RP</span><span class="o">/</span><span class="mi">0</span><span class="o">/</span><span class="mi">0</span><span class="o">/</span><span class="n">CPU0</span><span class="p">:</span><span class="n">AS65000_PE1</span><span class="c1">#ping 172.16.100.101</span>

<span class="n">Sun</span> <span class="n">May</span> <span class="mi">23</span> <span class="mi">16</span><span class="p">:</span><span class="mi">08</span><span class="p">:</span><span class="mf">08.862</span> <span class="n">UTC</span>

<span class="n">Type</span> <span class="n">escape</span> <span class="n">sequence</span> <span class="n">to</span> <span class="n">abort</span><span class="o">.</span>

<span class="n">Sending</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">100</span><span class="o">-</span><span class="n">byte</span> <span class="n">ICMP</span> <span class="n">Echos</span> <span class="n">to</span> <span class="mf">172.16.100.101</span><span class="p">,</span> <span class="n">timeout</span> <span class="ow">is</span> <span class="mi">2</span> <span class="n">seconds</span><span class="p">:</span>

<span class="n">UUUUU</span>

<span class="n">Success</span> <span class="n">rate</span> <span class="ow">is</span> <span class="mi">0</span> <span class="n">percent</span> <span class="p">(</span><span class="mi">0</span><span class="o">/</span><span class="mi">5</span><span class="p">)</span>

<span class="n">RP</span><span class="o">/</span><span class="mi">0</span><span class="o">/</span><span class="mi">0</span><span class="o">/</span><span class="n">CPU0</span><span class="p">:</span><span class="n">AS65000_PE1</span><span class="c1">#</span>

</pre></div>
</div>
<p>However, if we perform a path computation from the XTC device, which has a full view of the network topology, we should be able to see some results:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">RP</span><span class="o">/</span><span class="mi">0</span><span class="o">/</span><span class="mi">0</span><span class="o">/</span><span class="n">CPU0</span><span class="p">:</span><span class="n">AS65000_RR2</span><span class="c1">#sh pce ipv4 path source 172.16.0.11 destination 172.16.100.101</span>
<span class="n">Sun</span> <span class="n">May</span> <span class="mi">23</span> <span class="mi">16</span><span class="p">:</span><span class="mi">32</span><span class="p">:</span><span class="mf">47.661</span> <span class="n">UTC</span>

<span class="n">Path</span><span class="p">:</span>
<span class="o">----</span><span class="p">:</span>
<span class="n">Hop0</span><span class="p">:</span> <span class="mf">10.0.0.2</span>
<span class="n">Hop1</span><span class="p">:</span> <span class="mf">10.0.0.6</span>
<span class="n">Hop2</span><span class="p">:</span> <span class="mf">10.0.0.10</span>
<span class="n">Hop3</span><span class="p">:</span> <span class="mf">11.0.0.5</span>

</pre></div>
</div>
<p>Okay, so our XTC/PCE Server has a path to build an LSP! Start by configuring MPLS Traffic Engineering to use the PCE server.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>conf t
!
mpls traffic-eng
 pce
  peer source ipv4 172.16.0.11
  peer ipv4 172.16.0.202
  !
  segment-routing
  stateful-client
!
commit
end
</pre></div>
</div>
<p>Now, let’s configure the new tunnel interface to use IGP metrics across our topology with a path-option determined by the PCE/XTC.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>conf t
!
interface tunnel-te101
 ipv4 unnumbered Loopback0
 autoroute destination 172.16.100.101
 destination 172.16.100.101
 path-selection
  metric igp
 !
 path-option 1 dynamic pce address ipv4 172.16.0.202
!
end
</pre></div>
</div>
<p>The tunnel should now be built and established! Lets take a look at our tunnel details. Notice we are using the computed path from PCE! This path does not exists in our local route-table, particularly the last hop into unknown territory of ISIS Domain 100.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">Name</span><span class="p">:</span> <span class="n">tunnel</span><span class="o">-</span><span class="n">te101</span>  <span class="n">Destination</span><span class="p">:</span> <span class="mf">172.16.100.101</span>  <span class="n">Ifhandle</span><span class="p">:</span><span class="mh">0x1f0</span> 
  <span class="n">Signalled</span><span class="o">-</span><span class="n">Name</span><span class="p">:</span> <span class="n">AS65000_PE1_t101</span>
  <span class="n">Status</span><span class="p">:</span>
    <span class="n">Admin</span><span class="p">:</span>    <span class="n">up</span> <span class="n">Oper</span><span class="p">:</span>   <span class="n">up</span>   <span class="n">Path</span><span class="p">:</span>  <span class="n">valid</span>   <span class="n">Signalling</span><span class="p">:</span> <span class="n">connected</span>

    <span class="n">path</span> <span class="n">option</span> <span class="mi">1</span><span class="p">,</span>  <span class="nb">type</span> <span class="n">dynamic</span> <span class="n">pce</span> <span class="mf">172.16.0.202</span> <span class="p">(</span><span class="n">Basis</span> <span class="k">for</span> <span class="n">Setup</span><span class="p">,</span> <span class="n">path</span> <span class="n">weight</span> <span class="mi">220</span><span class="p">)</span>
    <span class="n">G</span><span class="o">-</span><span class="n">PID</span><span class="p">:</span> <span class="mh">0x0800</span> <span class="p">(</span><span class="n">derived</span> <span class="kn">from</span> <span class="nn">egress</span> <span class="n">interface</span> <span class="n">properties</span><span class="p">)</span>
    <span class="n">Bandwidth</span> <span class="n">Requested</span><span class="p">:</span> <span class="mi">0</span> <span class="n">kbps</span>  <span class="n">CT0</span>
    <span class="n">Creation</span> <span class="n">Time</span><span class="p">:</span> <span class="n">Sun</span> <span class="n">May</span> <span class="mi">23</span> <span class="mi">08</span><span class="p">:</span><span class="mi">49</span><span class="p">:</span><span class="mi">04</span> <span class="mi">2021</span> <span class="p">(</span><span class="mi">07</span><span class="p">:</span><span class="mi">54</span><span class="p">:</span><span class="mi">00</span> <span class="n">ago</span><span class="p">)</span>
  <span class="n">Config</span> <span class="n">Parameters</span><span class="p">:</span>
    <span class="n">Bandwidth</span><span class="p">:</span>        <span class="mi">0</span> <span class="n">kbps</span> <span class="p">(</span><span class="n">CT0</span><span class="p">)</span> <span class="n">Priority</span><span class="p">:</span>  <span class="mi">7</span>  <span class="mi">7</span> <span class="n">Affinity</span><span class="p">:</span> <span class="mh">0x0</span><span class="o">/</span><span class="mh">0xffff</span>
    <span class="n">Metric</span> <span class="n">Type</span><span class="p">:</span> <span class="n">IGP</span> <span class="p">(</span><span class="n">interface</span><span class="p">)</span>
    <span class="n">Path</span> <span class="n">Selection</span><span class="p">:</span>
      <span class="n">Tiebreaker</span><span class="p">:</span> <span class="n">Min</span><span class="o">-</span><span class="n">fill</span> <span class="p">(</span><span class="n">default</span><span class="p">)</span>
    <span class="n">Hop</span><span class="o">-</span><span class="n">limit</span><span class="p">:</span> <span class="n">disabled</span>
    <span class="n">Cost</span><span class="o">-</span><span class="n">limit</span><span class="p">:</span> <span class="n">disabled</span>
    <span class="n">Path</span><span class="o">-</span><span class="n">invalidation</span> <span class="n">timeout</span><span class="p">:</span> <span class="mi">10000</span> <span class="n">msec</span> <span class="p">(</span><span class="n">default</span><span class="p">),</span> <span class="n">Action</span><span class="p">:</span> <span class="n">Tear</span> <span class="p">(</span><span class="n">default</span><span class="p">)</span>
    <span class="n">AutoRoute</span><span class="p">:</span> <span class="n">disabled</span>  <span class="n">LockDown</span><span class="p">:</span> <span class="n">disabled</span>   <span class="n">Policy</span> <span class="n">class</span><span class="p">:</span> <span class="ow">not</span> <span class="nb">set</span>
    <span class="n">Forward</span> <span class="n">class</span><span class="p">:</span> <span class="mi">0</span> <span class="p">(</span><span class="n">default</span><span class="p">)</span>
    <span class="n">Forwarding</span><span class="o">-</span><span class="n">Adjacency</span><span class="p">:</span> <span class="n">disabled</span>
    <span class="n">Autoroute</span> <span class="n">Destinations</span><span class="p">:</span> <span class="mi">1</span>
    <span class="n">Loadshare</span><span class="p">:</span>          <span class="mi">0</span> <span class="n">equal</span> <span class="n">loadshares</span>
    <span class="n">Auto</span><span class="o">-</span><span class="n">bw</span><span class="p">:</span> <span class="n">disabled</span>
    <span class="n">Fast</span> <span class="n">Reroute</span><span class="p">:</span> <span class="n">Disabled</span><span class="p">,</span> <span class="n">Protection</span> <span class="n">Desired</span><span class="p">:</span> <span class="kc">None</span>
    <span class="n">Path</span> <span class="n">Protection</span><span class="p">:</span> <span class="n">Not</span> <span class="n">Enabled</span>
    <span class="n">BFD</span> <span class="n">Fast</span> <span class="n">Detection</span><span class="p">:</span> <span class="n">Disabled</span>
    <span class="n">Reoptimization</span> <span class="n">after</span> <span class="n">affinity</span> <span class="n">failure</span><span class="p">:</span> <span class="n">Enabled</span>
    <span class="n">Soft</span> <span class="n">Preemption</span><span class="p">:</span> <span class="n">Disabled</span>
  <span class="n">History</span><span class="p">:</span>
    <span class="n">Tunnel</span> <span class="n">has</span> <span class="n">been</span> <span class="n">up</span> <span class="k">for</span><span class="p">:</span> <span class="mi">07</span><span class="p">:</span><span class="mi">45</span><span class="p">:</span><span class="mi">13</span> <span class="p">(</span><span class="n">since</span> <span class="n">Sun</span> <span class="n">May</span> <span class="mi">23</span> <span class="mi">08</span><span class="p">:</span><span class="mi">57</span><span class="p">:</span><span class="mi">51</span> <span class="n">UTC</span> <span class="mi">2021</span><span class="p">)</span>
    <span class="n">Current</span> <span class="n">LSP</span><span class="p">:</span>
      <span class="n">Uptime</span><span class="p">:</span> <span class="mi">07</span><span class="p">:</span><span class="mi">45</span><span class="p">:</span><span class="mi">13</span> <span class="p">(</span><span class="n">since</span> <span class="n">Sun</span> <span class="n">May</span> <span class="mi">23</span> <span class="mi">08</span><span class="p">:</span><span class="mi">57</span><span class="p">:</span><span class="mi">51</span> <span class="n">UTC</span> <span class="mi">2021</span><span class="p">)</span>

  <span class="n">Path</span> <span class="n">info</span> <span class="p">(</span><span class="n">PCE</span> <span class="n">computed</span> <span class="n">path</span><span class="p">):</span>
  <span class="n">Hop0</span><span class="p">:</span> <span class="mf">10.0.0.3</span>
  <span class="n">Hop1</span><span class="p">:</span> <span class="mf">10.0.0.7</span>
  <span class="n">Hop2</span><span class="p">:</span> <span class="mf">10.0.0.11</span>
  <span class="n">Hop3</span><span class="p">:</span> <span class="mf">11.0.0.4</span>
<span class="n">Displayed</span> <span class="mi">1</span> <span class="p">(</span><span class="n">of</span> <span class="mi">5</span><span class="p">)</span> <span class="n">heads</span><span class="p">,</span> <span class="mi">0</span> <span class="p">(</span><span class="n">of</span> <span class="mi">0</span><span class="p">)</span> <span class="n">midpoints</span><span class="p">,</span> <span class="mi">0</span> <span class="p">(</span><span class="n">of</span> <span class="mi">2</span><span class="p">)</span> <span class="n">tails</span>
<span class="n">Displayed</span> <span class="mi">1</span> <span class="n">up</span><span class="p">,</span> <span class="mi">0</span> <span class="n">down</span><span class="p">,</span> <span class="mi">0</span> <span class="n">recovering</span><span class="p">,</span> <span class="mi">0</span> <span class="n">recovered</span> <span class="n">heads</span>
</pre></div>
</div>
<p>The same tunnel creation has been applied from PE101 back towards PE1 from PE101.
Lets take a quick look at the tunnel configuration from PE101:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>RP/0/0/CPU0:AS65000_PE101#show run interface tunnel-te11
Sun May 23 20:36:42.456 UTC
interface tunnel-te11
 ipv4 unnumbered Loopback0
 autoroute destination 172.16.0.11
 destination 172.16.0.11
 path-selection
  metric igp
 !
 path-option 1 dynamic pce address ipv4 172.16.0.202
!
</pre></div>
</div>
<p>And finally, let’s validate our MPLS te tunnel has a valid LSP path from PE101 to PE1</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>RP/0/0/CPU0:AS65000_PE101#traceroute mpls traffic-eng tunnel-te 11
Sun May 23 20:44:30.904 UTC

Tracing MPLS TE Label Switched Path on tunnel-te11, timeout is 2 seconds

Codes: &#39;!&#39; - success, &#39;Q&#39; - request not sent, &#39;.&#39; - timeout,
  &#39;L&#39; - labeled output interface, &#39;B&#39; - unlabeled output interface, 
  &#39;D&#39; - DS Map mismatch, &#39;F&#39; - no FEC mapping, &#39;f&#39; - FEC mismatch,
  &#39;M&#39; - malformed request, &#39;m&#39; - unsupported tlvs, &#39;N&#39; - no rx label, 
  &#39;P&#39; - no rx intf label prot, &#39;p&#39; - premature termination of LSP, 
  &#39;R&#39; - transit router, &#39;I&#39; - unknown upstream index,
  &#39;X&#39; - unknown return code, &#39;x&#39; - return code 0

Type escape sequence to abort.

  0 11.0.0.4 MRU 1500 [Labels: 24033 Exp: 0]
L 1 11.0.0.5 MRU 1500 [Labels: 24020 Exp: 0] 0 ms
. 2 *
. 3 *
! 4 10.0.0.2 30 ms
RP/0/0/CPU0:AS65000_PE101#
</pre></div>
</div>
</section>
<section id="mpls-lsp-from-xtc-with-segment-routing-as-transport">
<h1>MPLS LSP From XTC with Segment Routing as Transport<a class="headerlink" href="#mpls-lsp-from-xtc-with-segment-routing-as-transport" title="Permalink to this headline"></a></h1>
<p>This scenario is almost identical, but we take full advantage of Segment-Routing as the transport. We have already configured our MPLS Traffic-Engineering to contact the PCE server for Path-Computation and everything has been verified. Now, while creating our Tunnel Interfaces, our Path-Options will be Dynamic from PCE but with Segment Routing. Lets take a look at what a tunnel will look like from PE1 to PE4 within the same IS-IS Domain:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>RP/0/0/CPU0:AS65000_PE1#show run interface tunnel-te10044
Sun May 23 20:45:28.282 UTC
interface tunnel-te10044
 ipv4 unnumbered Loopback0
 destination 172.16.0.44
 path-selection
  metric igp
 !
 path-option 1 dynamic pce address ipv4 172.16.0.202 segment-routing
!

</pre></div>
</div>
<p>Great, our tunnel is configured and operationally up. Now, let’s review the Tunnel details and review the Path Option using Segment-Routing and the PCE Computed path by the XTC.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">RP</span><span class="o">/</span><span class="mi">0</span><span class="o">/</span><span class="mi">0</span><span class="o">/</span><span class="n">CPU0</span><span class="p">:</span><span class="n">AS65000_PE1</span><span class="c1">#show mpls traffic-eng tunnels 10044</span>
<span class="n">Sun</span> <span class="n">May</span> <span class="mi">23</span> <span class="mi">20</span><span class="p">:</span><span class="mi">46</span><span class="p">:</span><span class="mf">25.638</span> <span class="n">UTC</span>


<span class="n">Name</span><span class="p">:</span> <span class="n">tunnel</span><span class="o">-</span><span class="n">te10044</span>  <span class="n">Destination</span><span class="p">:</span> <span class="mf">172.16.0.44</span>  <span class="n">Ifhandle</span><span class="p">:</span><span class="mh">0x1d0</span> 
  <span class="n">Signalled</span><span class="o">-</span><span class="n">Name</span><span class="p">:</span> <span class="n">AS65000_PE1_t10044</span>
  <span class="n">Status</span><span class="p">:</span>
    <span class="n">Admin</span><span class="p">:</span>    <span class="n">up</span> <span class="n">Oper</span><span class="p">:</span>   <span class="n">up</span>   <span class="n">Path</span><span class="p">:</span>  <span class="n">valid</span>   <span class="n">Signalling</span><span class="p">:</span> <span class="n">connected</span>

    <span class="n">path</span> <span class="n">option</span> <span class="mi">1</span><span class="p">,</span> <span class="p">(</span><span class="n">Segment</span><span class="o">-</span><span class="n">Routing</span><span class="p">)</span> <span class="nb">type</span> <span class="n">dynamic</span> <span class="n">pce</span> <span class="mf">172.16.0.202</span> <span class="p">(</span><span class="n">Basis</span> <span class="k">for</span> <span class="n">Setup</span><span class="p">)</span>
        <span class="n">Reroute</span> <span class="n">pending</span> <span class="p">(</span><span class="n">Path</span><span class="o">-</span><span class="n">option</span> <span class="n">inuse</span> <span class="n">by</span> <span class="n">the</span> <span class="n">current</span> <span class="n">LSP</span> <span class="n">has</span> <span class="n">been</span> <span class="n">modified</span><span class="p">)</span>
      <span class="n">Bandwidth</span><span class="p">:</span>        <span class="mi">0</span> <span class="n">kbps</span> <span class="p">(</span><span class="n">CT0</span><span class="p">)</span> <span class="n">Priority</span><span class="p">:</span>  <span class="mi">7</span>  <span class="mi">7</span> <span class="n">Affinity</span><span class="p">:</span> <span class="mh">0x0</span><span class="o">/</span><span class="mh">0xffff</span>
      <span class="n">Metric</span> <span class="n">Type</span><span class="p">:</span> <span class="n">IGP</span> <span class="p">(</span><span class="n">interface</span><span class="p">)</span>
      <span class="n">Path</span> <span class="n">Selection</span><span class="p">:</span>
        <span class="n">Tiebreaker</span><span class="p">:</span> <span class="n">Min</span><span class="o">-</span><span class="n">fill</span> <span class="p">(</span><span class="n">default</span><span class="p">)</span>
        <span class="n">Protection</span><span class="p">:</span> <span class="nb">any</span> <span class="p">(</span><span class="n">default</span><span class="p">)</span>
      <span class="n">Hop</span><span class="o">-</span><span class="n">limit</span><span class="p">:</span> <span class="n">disabled</span>
      <span class="n">Cost</span><span class="o">-</span><span class="n">limit</span><span class="p">:</span> <span class="n">disabled</span>
      <span class="n">Path</span><span class="o">-</span><span class="n">invalidation</span> <span class="n">timeout</span><span class="p">:</span> <span class="mi">10000</span> <span class="n">msec</span> <span class="p">(</span><span class="n">default</span><span class="p">),</span> <span class="n">Action</span><span class="p">:</span> <span class="n">Tear</span> <span class="p">(</span><span class="n">default</span><span class="p">)</span>
    <span class="n">Last</span> <span class="n">PCALC</span> <span class="n">Error</span> <span class="p">[</span><span class="n">Reopt</span><span class="p">]:</span> <span class="n">Sun</span> <span class="n">May</span> <span class="mi">23</span> <span class="mi">08</span><span class="p">:</span><span class="mi">42</span><span class="p">:</span><span class="mi">33</span> <span class="mi">2021</span>
      <span class="n">Info</span><span class="p">:</span> <span class="n">failed</span> <span class="n">to</span> <span class="n">find</span> <span class="n">path</span>
    <span class="n">G</span><span class="o">-</span><span class="n">PID</span><span class="p">:</span> <span class="mh">0x0800</span> <span class="p">(</span><span class="n">derived</span> <span class="kn">from</span> <span class="nn">egress</span> <span class="n">interface</span> <span class="n">properties</span><span class="p">)</span>
    <span class="n">Bandwidth</span> <span class="n">Requested</span><span class="p">:</span> <span class="mi">0</span> <span class="n">kbps</span>  <span class="n">CT0</span>
    <span class="n">Creation</span> <span class="n">Time</span><span class="p">:</span> <span class="n">Sun</span> <span class="n">May</span> <span class="mi">23</span> <span class="mi">08</span><span class="p">:</span><span class="mi">38</span><span class="p">:</span><span class="mi">54</span> <span class="mi">2021</span> <span class="p">(</span><span class="mi">12</span><span class="p">:</span><span class="mi">07</span><span class="p">:</span><span class="mi">31</span> <span class="n">ago</span><span class="p">)</span>
  <span class="n">Config</span> <span class="n">Parameters</span><span class="p">:</span>
    <span class="n">Bandwidth</span><span class="p">:</span>        <span class="mi">0</span> <span class="n">kbps</span> <span class="p">(</span><span class="n">CT0</span><span class="p">)</span> <span class="n">Priority</span><span class="p">:</span>  <span class="mi">7</span>  <span class="mi">7</span> <span class="n">Affinity</span><span class="p">:</span> <span class="mh">0x0</span><span class="o">/</span><span class="mh">0xffff</span>
    <span class="n">Metric</span> <span class="n">Type</span><span class="p">:</span> <span class="n">IGP</span> <span class="p">(</span><span class="n">interface</span><span class="p">)</span>
    <span class="n">Path</span> <span class="n">Selection</span><span class="p">:</span>
      <span class="n">Tiebreaker</span><span class="p">:</span> <span class="n">Min</span><span class="o">-</span><span class="n">fill</span> <span class="p">(</span><span class="n">default</span><span class="p">)</span>
      <span class="n">Protection</span><span class="p">:</span> <span class="nb">any</span> <span class="p">(</span><span class="n">default</span><span class="p">)</span>
    <span class="n">Hop</span><span class="o">-</span><span class="n">limit</span><span class="p">:</span> <span class="n">disabled</span>
    <span class="n">Cost</span><span class="o">-</span><span class="n">limit</span><span class="p">:</span> <span class="n">disabled</span>
    <span class="n">Path</span><span class="o">-</span><span class="n">invalidation</span> <span class="n">timeout</span><span class="p">:</span> <span class="mi">10000</span> <span class="n">msec</span> <span class="p">(</span><span class="n">default</span><span class="p">),</span> <span class="n">Action</span><span class="p">:</span> <span class="n">Tear</span> <span class="p">(</span><span class="n">default</span><span class="p">)</span>
    <span class="n">AutoRoute</span><span class="p">:</span> <span class="n">disabled</span>  <span class="n">LockDown</span><span class="p">:</span> <span class="n">disabled</span>   <span class="n">Policy</span> <span class="n">class</span><span class="p">:</span> <span class="ow">not</span> <span class="nb">set</span>
    <span class="n">Forward</span> <span class="n">class</span><span class="p">:</span> <span class="mi">0</span> <span class="p">(</span><span class="n">default</span><span class="p">)</span>
    <span class="n">Forwarding</span><span class="o">-</span><span class="n">Adjacency</span><span class="p">:</span> <span class="n">disabled</span>
    <span class="n">Autoroute</span> <span class="n">Destinations</span><span class="p">:</span> <span class="mi">0</span>
    <span class="n">Loadshare</span><span class="p">:</span>          <span class="mi">0</span> <span class="n">equal</span> <span class="n">loadshares</span>
    <span class="n">Auto</span><span class="o">-</span><span class="n">bw</span><span class="p">:</span> <span class="n">disabled</span>
    <span class="n">Path</span> <span class="n">Protection</span><span class="p">:</span> <span class="n">Not</span> <span class="n">Enabled</span>
    <span class="n">BFD</span> <span class="n">Fast</span> <span class="n">Detection</span><span class="p">:</span> <span class="n">Disabled</span>
    <span class="n">Reoptimization</span> <span class="n">after</span> <span class="n">affinity</span> <span class="n">failure</span><span class="p">:</span> <span class="n">Enabled</span>
    <span class="n">SRLG</span> <span class="n">discovery</span><span class="p">:</span> <span class="n">Disabled</span>
  <span class="n">History</span><span class="p">:</span>
    <span class="n">Tunnel</span> <span class="n">has</span> <span class="n">been</span> <span class="n">up</span> <span class="k">for</span><span class="p">:</span> <span class="mi">12</span><span class="p">:</span><span class="mi">05</span><span class="p">:</span><span class="mi">04</span> <span class="p">(</span><span class="n">since</span> <span class="n">Sun</span> <span class="n">May</span> <span class="mi">23</span> <span class="mi">08</span><span class="p">:</span><span class="mi">41</span><span class="p">:</span><span class="mi">21</span> <span class="n">UTC</span> <span class="mi">2021</span><span class="p">)</span>
    <span class="n">Current</span> <span class="n">LSP</span><span class="p">:</span>
      <span class="n">Uptime</span><span class="p">:</span> <span class="mi">12</span><span class="p">:</span><span class="mi">05</span><span class="p">:</span><span class="mi">04</span> <span class="p">(</span><span class="n">since</span> <span class="n">Sun</span> <span class="n">May</span> <span class="mi">23</span> <span class="mi">08</span><span class="p">:</span><span class="mi">41</span><span class="p">:</span><span class="mi">21</span> <span class="n">UTC</span> <span class="mi">2021</span><span class="p">)</span>
    <span class="n">Reopt</span><span class="o">.</span> <span class="n">LSP</span><span class="p">:</span>
      <span class="n">Last</span> <span class="n">Failure</span><span class="p">:</span>
        <span class="n">LSP</span> <span class="ow">not</span> <span class="n">signalled</span><span class="p">,</span> <span class="n">has</span> <span class="n">no</span> <span class="n">S2Ls</span>
        <span class="n">Date</span><span class="o">/</span><span class="n">Time</span><span class="p">:</span> <span class="n">Sun</span> <span class="n">May</span> <span class="mi">23</span> <span class="mi">20</span><span class="p">:</span><span class="mi">46</span><span class="p">:</span><span class="mi">21</span> <span class="n">UTC</span> <span class="mi">2021</span> <span class="p">[</span><span class="mi">00</span><span class="p">:</span><span class="mi">00</span><span class="p">:</span><span class="mi">04</span> <span class="n">ago</span><span class="p">]</span>

  <span class="n">Path</span> <span class="n">info</span> <span class="p">(</span><span class="n">PCE</span> <span class="n">computed</span> <span class="n">path</span><span class="p">):</span>
  <span class="n">Hop0</span><span class="p">:</span> <span class="mf">10.0.0.3</span>
  <span class="n">Hop1</span><span class="p">:</span> <span class="mf">10.0.0.7</span>
  <span class="n">Hop2</span><span class="p">:</span> <span class="mf">10.0.0.11</span>
<span class="n">Displayed</span> <span class="mi">1</span> <span class="p">(</span><span class="n">of</span> <span class="mi">5</span><span class="p">)</span> <span class="n">heads</span><span class="p">,</span> <span class="mi">0</span> <span class="p">(</span><span class="n">of</span> <span class="mi">0</span><span class="p">)</span> <span class="n">midpoints</span><span class="p">,</span> <span class="mi">0</span> <span class="p">(</span><span class="n">of</span> <span class="mi">3</span><span class="p">)</span> <span class="n">tails</span>
<span class="n">Displayed</span> <span class="mi">1</span> <span class="n">up</span><span class="p">,</span> <span class="mi">0</span> <span class="n">down</span><span class="p">,</span> <span class="mi">0</span> <span class="n">recovering</span><span class="p">,</span> <span class="mi">0</span> <span class="n">recovered</span> <span class="n">heads</span>
<span class="n">RP</span><span class="o">/</span><span class="mi">0</span><span class="o">/</span><span class="mi">0</span><span class="o">/</span><span class="n">CPU0</span><span class="p">:</span><span class="n">AS65000_PE1</span><span class="c1">#</span>
</pre></div>
</div>
<p>Looks like everything is working! We could now deploy VPN services across this multi-domain network, as we have fully established a bi-directional LSP path from IS-IS Domain CORE and IS-IS Domain 100.</p>
</section>
<section class="tex2jax_ignore mathjax_ignore" id="troubleshooting-commands">
<h1>Troubleshooting commands<a class="headerlink" href="#troubleshooting-commands" title="Permalink to this headline"></a></h1>
<ul class="simple">
<li><p>show mpls traffic-eng pce peer</p>
<ul>
<li><p>Validate the session establishment with the XR Traffic Controller.</p></li>
</ul>
</li>
<li><p>show mpls traffic-eng tunnels {tunnel_name}</p>
<ul>
<li><p>View MPLS tunnel information in detail, such as PCE computated path.</p></li>
</ul>
</li>
<li><p>traceroute mpls traffic-eng tunnel-te {tunel id}</p>
<ul>
<li><p>MPLS traceroute</p></li>
<li></li>
</ul>
</li>
</ul>
<section id="summary">
<h2>Summary<a class="headerlink" href="#summary" title="Permalink to this headline"></a></h2>
<p>The power of the XR Controller to allow you dynamically create IP/MPLS or Segment-Routing Traffic Engineered tunnels is incredible. We have only scratched the surface, but this is enough to understand the concept of what XTC is providing for a large SP Network. There are some use-cases that have been shared by networks who are using this feature in production and it looks very promising. I can think of a specific merger in my career that we could have benefited greatly from this. As XTC has been fully implemented to be a feature of the IOSXR Family, it’s going to become incredibly easy to adopt in production networks. One thing to note is that BGP-LS is playing a KEY role in the success of XTC. Hopefully this has covered enough grounds for the SPAUTO exam and look forward to taking the exam and being prepared in this topic!</p>
</section>
<section id="what-s-next">
<h2>What’s Next?!<a class="headerlink" href="#what-s-next" title="Permalink to this headline"></a></h2>
<p>For my next blog, I will be using a similar use-case with XTC, but also automagically deploy a L3VPN or L2VPN with the help of an NSO instance! This will showcase how incredibly useful NSO can be when paired with XTC from the perspective of a Large Network Operator. Stay Tuned!</p>
</section>
</section>


           </div>
          </div>
          <footer>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2021, Hugo Tinoco.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>